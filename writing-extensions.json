{"version":3,"kind":"Article","sha256":"36169774558a9fcff8cde9c0149f1caf0a9daa5de88f107d33b7edc4484b04ed","slug":"writing-extensions","location":"/developer-guide/03-development/writing-extensions.md","dependencies":[],"frontmatter":{"title":"Writing Custom Extensions","content_includes_title":false,"authors":[{"nameParsed":{"literal":"Soft Mentor","given":"Soft","family":"Mentor"},"name":"Soft Mentor","id":"contributors-myst-generated-uid-0"}],"github":"https://github.com/softmentor/devflow","abbreviations":{"ADR":"Architecture Decision Record.","API":"Application Programming Interface.","CI":"Continuous Integration.","CLI":"Command Line Interface.","DAG":"Directed Acyclic Graph.","GHCR":"GitHub Container Registry.","PR":"Pull Request."},"numbering":{"title":{"offset":2}},"source_url":"https://github.com/softmentor/devflow/blob/main/docs/developer-guide/03-development/writing-extensions.md","edit_url":"https://github.com/softmentor/devflow/edit/main/docs/developer-guide/03-development/writing-extensions.md","exports":[{"format":"md","filename":"writing-extensions.md","url":"/devflow/build/writing-extensions-be1f2be9fd7ac24e150652c8bbf13e41.md"}]},"mdast":{"type":"root","children":[{"type":"block","children":[{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Devflow allows you to write custom workflow extensions in ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"Z9X9DccBdo"},{"type":"strong","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"any language","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"OWINzFtNNt"}],"key":"B6OG6UVFmL"},{"type":"text","value":". Because Devflow interacts with extensions using a simple JSON over standard I/O (often referred to as a “JSON-RPC” protocol via ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"gnu6yOxVyQ"},{"type":"inlineCode","value":"--discover","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"DlrLMZLQkV"},{"type":"text","value":" and ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"ULnv0S1MgP"},{"type":"inlineCode","value":"--build-action","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"QDxbC4KqaV"},{"type":"text","value":"), you are not constrained to writing Rust code to extend the ","key":"fRT46kJ1W3"},{"type":"abbreviation","title":"Command Line Interface.","children":[{"type":"text","value":"CLI","key":"LebnPqwW3e"}],"key":"GSFe0XY5EL"},{"type":"text","value":".","key":"y9n0uoNI7l"}],"key":"AhugG0zFUU"},{"type":"paragraph","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"This guide explains how external developers can write, debug, and test Devflow extensions locally.","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"A3UNtbUZw3"}],"key":"XHwDs1UEgh"},{"type":"heading","depth":2,"position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"text","value":"The Extension Protocol","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"tB46GLYBeN"}],"identifier":"the-extension-protocol","label":"The Extension Protocol","html_id":"the-extension-protocol","implicit":true,"key":"vyna5G9ri4"},{"type":"paragraph","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"children":[{"type":"text","value":"To create a Devflow extension, you need an executable script or binary whose name starts with a ","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"z5NtOGgsZV"},{"type":"inlineCode","value":"devflow-ext-","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"SeSdkkxAoS"},{"type":"text","value":" prefix. Devflow uses this prefix to discover your logic.","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"NGS5ZKauSR"}],"key":"uFgNs99Qyi"},{"type":"paragraph","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"children":[{"type":"text","value":"Your extension must handle two ","key":"k6XtSuUsLW"},{"type":"abbreviation","title":"Command Line Interface.","children":[{"type":"text","value":"CLI","key":"Wur3bxvskV"}],"key":"crgA7DW3kT"},{"type":"text","value":" flags:","key":"QSbH4uzpEu"}],"key":"jwT5lT0DOq"},{"type":"list","ordered":true,"start":1,"spread":false,"position":{"start":{"line":12,"column":1},"end":{"line":14,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"children":[{"type":"paragraph","children":[{"type":"inlineCode","value":"--discover","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"key":"rLRPKFDRy5"},{"type":"text","value":": Announce what Devflow features you support.","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"key":"K1b6kHoM39"}],"key":"x7lWvHudn0"}],"key":"duhR31LjIR"},{"type":"listItem","spread":true,"position":{"start":{"line":13,"column":1},"end":{"line":14,"column":1}},"children":[{"type":"paragraph","children":[{"type":"inlineCode","value":"--build-action","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"key":"d4OjUJ5I3R"},{"type":"text","value":": Receive a parsed command and tell Devflow what to run.","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"key":"bhImxX3hge"}],"key":"KjghHJYq4a"}],"key":"McmPcJfOWH"}],"key":"bonDUQ8A66"},{"type":"heading","depth":3,"position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"children":[{"type":"text","value":"Step 1: Handling ","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"key":"tCYSuhsH09"},{"type":"inlineCode","value":"--discover","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"key":"js8lSSAllh"}],"identifier":"step-1-handling-discover","label":"Step 1: Handling --discover","html_id":"step-1-handling-discover","implicit":true,"key":"rk5ojIClTd"},{"type":"paragraph","position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"children":[{"type":"text","value":"When ","position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"key":"mPGMnxHh9p"},{"type":"inlineCode","value":"devflow","position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"key":"o5w5f22Ub1"},{"type":"text","value":" runs or boots up, it looks for extension binaries in your ","position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"key":"aHz3wML11Z"},{"type":"inlineCode","value":"$PATH","position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"key":"Ctl8zEeNKi"},{"type":"text","value":" and queries them using:","position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"key":"WzgjfT87I1"}],"key":"fDctzKSlff"},{"type":"code","lang":"bash","value":"devflow-ext-myext --discover","position":{"start":{"line":18,"column":1},"end":{"line":20,"column":1}},"key":"oZHREaVFhu"},{"type":"paragraph","position":{"start":{"line":21,"column":1},"end":{"line":21,"column":1}},"children":[{"type":"text","value":"Your script must output a JSON array of supported capabilities to ","position":{"start":{"line":21,"column":1},"end":{"line":21,"column":1}},"key":"xKH8GZ93Wf"},{"type":"inlineCode","value":"stdout","position":{"start":{"line":21,"column":1},"end":{"line":21,"column":1}},"key":"rHZyp6RWJM"},{"type":"text","value":" and exit with code ","position":{"start":{"line":21,"column":1},"end":{"line":21,"column":1}},"key":"Nb3xWMXvzm"},{"type":"inlineCode","value":"0","position":{"start":{"line":21,"column":1},"end":{"line":21,"column":1}},"key":"YVytg4XU6m"},{"type":"text","value":".","position":{"start":{"line":21,"column":1},"end":{"line":21,"column":1}},"key":"MWVQUnP4Wc"}],"key":"nMu1fDRE0N"},{"type":"paragraph","position":{"start":{"line":23,"column":1},"end":{"line":23,"column":1}},"children":[{"type":"strong","position":{"start":{"line":23,"column":1},"end":{"line":23,"column":1}},"children":[{"type":"text","value":"Example Python implementation:","position":{"start":{"line":23,"column":1},"end":{"line":23,"column":1}},"key":"jZGoQ17Vv8"}],"key":"x9GfxLLpGN"}],"key":"COnbrn7j3H"},{"type":"code","lang":"python","value":"import sys\nimport json\n\nif \"--discover\" in sys.argv:\n    # Say that we support \"test\" and \"fmt\"\n    print(json.dumps([\"test\", \"fmt\", \"test:lint\"]))\n    sys.exit(0)","position":{"start":{"line":24,"column":1},"end":{"line":32,"column":1}},"key":"MDAhwNMgLq"},{"type":"heading","depth":3,"position":{"start":{"line":34,"column":1},"end":{"line":34,"column":1}},"children":[{"type":"text","value":"Step 2: Handling ","position":{"start":{"line":34,"column":1},"end":{"line":34,"column":1}},"key":"w4yVVQ3GBc"},{"type":"inlineCode","value":"--build-action","position":{"start":{"line":34,"column":1},"end":{"line":34,"column":1}},"key":"i1ltlGD92U"}],"identifier":"step-2-handling-build-action","label":"Step 2: Handling --build-action","html_id":"step-2-handling-build-action","implicit":true,"key":"CVBUKE7ArM"},{"type":"paragraph","position":{"start":{"line":36,"column":1},"end":{"line":36,"column":1}},"children":[{"type":"text","value":"When a user runs a supported command (e.g., ","position":{"start":{"line":36,"column":1},"end":{"line":36,"column":1}},"key":"HGD9W01JBC"},{"type":"inlineCode","value":"devflow test","position":{"start":{"line":36,"column":1},"end":{"line":36,"column":1}},"key":"X3j0OwsJNy"},{"type":"text","value":"), Devflow matches the ","position":{"start":{"line":36,"column":1},"end":{"line":36,"column":1}},"key":"q2Pqj73pQv"},{"type":"inlineCode","value":"\"test\"","position":{"start":{"line":36,"column":1},"end":{"line":36,"column":1}},"key":"i6kbpd8njx"},{"type":"text","value":" capability to your extension. It then executes your extension, streaming a JSON ","position":{"start":{"line":36,"column":1},"end":{"line":36,"column":1}},"key":"ZRGFrWjefJ"},{"type":"inlineCode","value":"CommandRef","position":{"start":{"line":36,"column":1},"end":{"line":36,"column":1}},"key":"L65t69y6QM"},{"type":"text","value":" payload via ","position":{"start":{"line":36,"column":1},"end":{"line":36,"column":1}},"key":"EPzUv1JQ1n"},{"type":"inlineCode","value":"stdin","position":{"start":{"line":36,"column":1},"end":{"line":36,"column":1}},"key":"ep9dS8JkxP"},{"type":"text","value":".","position":{"start":{"line":36,"column":1},"end":{"line":36,"column":1}},"key":"J4aT99jhSf"}],"key":"Tehn2lcyR6"},{"type":"code","lang":"bash","value":"echo '{\"primary\": \"test\"}' | devflow-ext-myext --build-action","position":{"start":{"line":38,"column":1},"end":{"line":40,"column":1}},"key":"vpPgvtoU3L"},{"type":"paragraph","position":{"start":{"line":42,"column":1},"end":{"line":42,"column":1}},"children":[{"type":"text","value":"Your script reads this JSON struct, decides what underlying programs to call, and returns a JSON ","position":{"start":{"line":42,"column":1},"end":{"line":42,"column":1}},"key":"whmPQZPw39"},{"type":"inlineCode","value":"ExecutionAction","position":{"start":{"line":42,"column":1},"end":{"line":42,"column":1}},"key":"yRyo2R55Cb"},{"type":"text","value":" to ","position":{"start":{"line":42,"column":1},"end":{"line":42,"column":1}},"key":"fwHOf9GLDV"},{"type":"inlineCode","value":"stdout","position":{"start":{"line":42,"column":1},"end":{"line":42,"column":1}},"key":"Rywbmm7Njl"},{"type":"text","value":".","position":{"start":{"line":42,"column":1},"end":{"line":42,"column":1}},"key":"bLKTDIvFJd"}],"key":"RfXWLyDgNJ"},{"type":"paragraph","position":{"start":{"line":44,"column":1},"end":{"line":44,"column":1}},"children":[{"type":"strong","position":{"start":{"line":44,"column":1},"end":{"line":44,"column":1}},"children":[{"type":"text","value":"Example Python implementation:","position":{"start":{"line":44,"column":1},"end":{"line":44,"column":1}},"key":"PytMple2QV"}],"key":"fuY8iXlFFl"}],"key":"EWhtlTd90L"},{"type":"code","lang":"python","value":"if \"--build-action\" in sys.argv:\n    # Read CommandRef from standard input\n    input_data = sys.stdin.read()\n    cmd_ref = json.loads(input_data)\n    \n    # Analyze the command\n    primary = cmd_ref.get(\"primary\")\n    selector = cmd_ref.get(\"selector\")\n    \n    # Tell Devflow what to execute\n    if primary == \"test\":\n        if selector == \"lint\":\n            action = {\"program\": \"flake8\", \"args\": [\".\"]}\n        else:\n            action = {\"program\": \"pytest\", \"args\": [\"tests/\"]}\n        \n        # Print the execution action for devflow to run\n        print(json.dumps(action))\n        sys.exit(0)","position":{"start":{"line":45,"column":1},"end":{"line":65,"column":1}},"key":"kTeBtlNCvq"},{"type":"heading","depth":2,"position":{"start":{"line":67,"column":1},"end":{"line":67,"column":1}},"children":[{"type":"text","value":"Developing and Debugging Locally","position":{"start":{"line":67,"column":1},"end":{"line":67,"column":1}},"key":"Fah04Ww7Gb"}],"identifier":"developing-and-debugging-locally","label":"Developing and Debugging Locally","html_id":"developing-and-debugging-locally","implicit":true,"key":"PYCRHqLtQv"},{"type":"list","ordered":true,"start":1,"spread":false,"position":{"start":{"line":69,"column":1},"end":{"line":85,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":69,"column":1},"end":{"line":69,"column":1}},"children":[{"type":"paragraph","children":[{"type":"strong","position":{"start":{"line":69,"column":1},"end":{"line":69,"column":1}},"children":[{"type":"text","value":"Write your script","position":{"start":{"line":69,"column":1},"end":{"line":69,"column":1}},"key":"ZrfoyYU5GF"}],"key":"FGnFt8hd3j"},{"type":"text","value":": Write a script (e.g. ","position":{"start":{"line":69,"column":1},"end":{"line":69,"column":1}},"key":"VOUdboyjXW"},{"type":"inlineCode","value":"devflow-ext-myext.sh","position":{"start":{"line":69,"column":1},"end":{"line":69,"column":1}},"key":"W80EDtpGaV"},{"type":"text","value":" or ","position":{"start":{"line":69,"column":1},"end":{"line":69,"column":1}},"key":"FDUT1HHgic"},{"type":"inlineCode","value":"devflow-ext-python","position":{"start":{"line":69,"column":1},"end":{"line":69,"column":1}},"key":"mQp4vSDwoM"},{"type":"text","value":") handling ","position":{"start":{"line":69,"column":1},"end":{"line":69,"column":1}},"key":"RVHjfcD9FI"},{"type":"inlineCode","value":"--discover","position":{"start":{"line":69,"column":1},"end":{"line":69,"column":1}},"key":"oYvLNesxjY"},{"type":"text","value":" and ","position":{"start":{"line":69,"column":1},"end":{"line":69,"column":1}},"key":"zSx2FvKZbh"},{"type":"inlineCode","value":"--build-action","position":{"start":{"line":69,"column":1},"end":{"line":69,"column":1}},"key":"XbfdCw6Gcl"},{"type":"text","value":". Make sure it’s executable (","position":{"start":{"line":69,"column":1},"end":{"line":69,"column":1}},"key":"HVS3mE7dD3"},{"type":"inlineCode","value":"chmod +x","position":{"start":{"line":69,"column":1},"end":{"line":69,"column":1}},"key":"Q6YK5LScUl"},{"type":"text","value":").","position":{"start":{"line":69,"column":1},"end":{"line":69,"column":1}},"key":"dyhy3Y88mH"}],"key":"zZhiUDLS2S"}],"key":"cQLoP3hDbR"},{"type":"listItem","spread":true,"position":{"start":{"line":70,"column":1},"end":{"line":73,"column":1}},"children":[{"type":"paragraph","children":[{"type":"strong","position":{"start":{"line":70,"column":1},"end":{"line":70,"column":1}},"children":[{"type":"text","value":"Add to PATH","position":{"start":{"line":70,"column":1},"end":{"line":70,"column":1}},"key":"be7VLLKkwa"}],"key":"G4XqE1WEn7"},{"type":"text","value":": Add the directory containing your script to your system ","position":{"start":{"line":70,"column":1},"end":{"line":70,"column":1}},"key":"ZLbM49S02K"},{"type":"inlineCode","value":"$PATH","position":{"start":{"line":70,"column":1},"end":{"line":70,"column":1}},"key":"K39AIIqaFN"},{"type":"text","value":" so Devflow can find it during discovery.","position":{"start":{"line":70,"column":1},"end":{"line":70,"column":1}},"key":"cFbZV9n0WE"}],"key":"T7ZGFTtfj3"},{"type":"code","lang":"bash","value":"export PATH=\"/path/to/your/script/dir:$PATH\"","position":{"start":{"line":71,"column":1},"end":{"line":73,"column":1}},"key":"RkgiC41PHh"}],"key":"z2vhjwJ2PN"},{"type":"listItem","spread":true,"position":{"start":{"line":74,"column":1},"end":{"line":83,"column":1}},"children":[{"type":"paragraph","children":[{"type":"strong","position":{"start":{"line":74,"column":1},"end":{"line":74,"column":1}},"children":[{"type":"text","value":"Debug independent of Devflow","position":{"start":{"line":74,"column":1},"end":{"line":74,"column":1}},"key":"z30Pr1NTqg"}],"key":"zfLPKHrPvO"},{"type":"text","value":": Because the protocol is simply JSON over standard streams, you can test it directly in your terminal without Devflow:","position":{"start":{"line":74,"column":1},"end":{"line":74,"column":1}},"key":"S8QJLwCMbz"}],"key":"QafLs3L63v"},{"type":"code","lang":"bash","value":"# Test discovery\n./devflow-ext-python --discover\n\n# Test building an action\necho '{\"primary\": \"test\", \"selector\": \"lint\"}' | ./devflow-ext-python --build-action","position":{"start":{"line":75,"column":1},"end":{"line":81,"column":1}},"key":"hR9mfOsiyV"},{"type":"paragraph","children":[{"type":"emphasis","position":{"start":{"line":75,"column":1},"end":{"line":75,"column":1}},"children":[{"type":"text","value":"Expected manual test output:","position":{"start":{"line":75,"column":1},"end":{"line":75,"column":1}},"key":"QCHJWPMI3r"}],"key":"yCFiLj2mU3"},{"type":"text","value":"\n","position":{"start":{"line":75,"column":1},"end":{"line":75,"column":1}},"key":"bkxNoeEw44"},{"type":"inlineCode","value":"{\"program\": \"flake8\", \"args\": [\".\"]}","position":{"start":{"line":75,"column":1},"end":{"line":75,"column":1}},"key":"uj8m0IFCLk"}],"key":"wTaxaD5AHd"}],"key":"UXfIKdH2yw"},{"type":"listItem","spread":true,"position":{"start":{"line":84,"column":1},"end":{"line":85,"column":1}},"children":[{"type":"paragraph","children":[{"type":"strong","position":{"start":{"line":84,"column":1},"end":{"line":84,"column":1}},"children":[{"type":"text","value":"Integration Test with Devflow","position":{"start":{"line":84,"column":1},"end":{"line":84,"column":1}},"key":"XrHeWxUCGc"}],"key":"DLbzhvQkNz"},{"type":"text","value":": Once the ","key":"Wg4ALpcwvB"},{"type":"abbreviation","title":"Command Line Interface.","children":[{"type":"text","value":"CLI","key":"VGl2k5bfjy"}],"key":"wewKskZFET"},{"type":"text","value":" commands output correct JSON, you can run Devflow on any project and it will immediately delegate execution to your binary!","key":"zIy0ZBPpZw"}],"key":"ImIdfjNbIh"}],"key":"QaBWfpjkvX"}],"key":"CUlrnFhXFx"},{"type":"heading","depth":2,"position":{"start":{"line":86,"column":1},"end":{"line":86,"column":1}},"children":[{"type":"text","value":"Examples","position":{"start":{"line":86,"column":1},"end":{"line":86,"column":1}},"key":"yU1W7mUkpR"}],"identifier":"examples","label":"Examples","html_id":"examples","implicit":true,"key":"zsDtZr53xA"},{"type":"paragraph","position":{"start":{"line":88,"column":1},"end":{"line":88,"column":1}},"children":[{"type":"text","value":"We provide sample implementations of this protocol to guide your development:","position":{"start":{"line":88,"column":1},"end":{"line":88,"column":1}},"key":"mf44AmiEnH"}],"key":"rveJSUIIVg"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":89,"column":1},"end":{"line":89,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":89,"column":1},"end":{"line":89,"column":1}},"children":[{"type":"paragraph","children":[{"type":"link","url":"https://github.com/organization/devflow/tree/main/examples/python-ext","position":{"start":{"line":89,"column":1},"end":{"line":89,"column":1}},"children":[{"type":"text","value":"Python Example Extension","position":{"start":{"line":89,"column":1},"end":{"line":89,"column":1}},"key":"IGkWxRpT5p"}],"urlSource":"https://github.com/organization/devflow/tree/main/examples/python-ext","error":true,"key":"rfTjpvKTdP"}],"key":"cUbz460OvP"}],"key":"rce1D0Ezbb"}],"key":"GEJpCdYkGG"}],"key":"KA2KVToMWQ"}],"key":"rDNm0TuWaT"},"references":{"cite":{"order":[],"data":{}}},"footer":{"navigation":{"prev":{"title":"Dogfooding Strategy","url":"/dogfooding","group":"03 Development"},"next":{"title":"Infrastructure Overview","url":"/overview","group":"04 Infrastructure"}}},"domain":"http://localhost:3000"}